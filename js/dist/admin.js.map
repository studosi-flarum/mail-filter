{"version":3,"sources":["webpack://@studosi/mail-filter/webpack/bootstrap","webpack://@studosi/mail-filter/./admin.js","webpack://@studosi/mail-filter/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@studosi/mail-filter/./src/admin/addSettingsPage.js","webpack://@studosi/mail-filter/./src/admin/components/settingsPage.js","webpack://@studosi/mail-filter/./src/admin/index.js","webpack://@studosi/mail-filter/./src/common/models/rule.js","webpack://@studosi/mail-filter/external \"flarum.core.compat['Model']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['components/AdminLinkButton']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['components/AdminNav']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['components/Alert']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['components/Button']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['components/Page']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['components/Switch']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['extend']\"","webpack://@studosi/mail-filter/external \"flarum.core.compat['utils/mixin']\""],"names":["app","routes","path","component","SettingsPage","extensionSettings","m","route","extend","AdminNav","prototype","items","add","AdminLinkButton","href","icon","children","translator","trans","description","key_to_id","id_to_key","init","storage","store","find","then","loadRules","bind","newRules","isRegex","key","name","prop","value","length","getExistingBlock","full_key","map","rule","className","style","display","Switch","state","active","onchange","toggleRuleActivity","placeholder","oninput","withAttr","updateRuleName","updateRuleValue","Button","type","onclick","removeRule","getNewBlock","addRule","getBlock","view","save","checkRegex","RegExp","e","alert","createRecord","rule_type","push","redraw","rule_to_remove","some","i","data","id","splice","rules","entry","Page","initializers","models","mail_rules","Rule","addSettingsPage","mixin","Model","attribute"],"mappings":"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","file":"admin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./admin.js\");\n","/*\n * Copyright 2020 Studosi\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './src/admin';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","/*\n * Copyright 2020 Studosi\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { extend } from 'flarum/extend';\nimport AdminNav from 'flarum/components/AdminNav';\nimport AdminLinkButton from 'flarum/components/AdminLinkButton';\n\nimport SettingsPage from './components/settingsPage';\n\n\nexport default function()\n{\n  app.routes[\"studosi/mail-filter\"] =\n    {\n      path: \"/studosi/mail-filter\",\n      component: SettingsPage.component()\n    };\n  app.extensionSettings[\"studosi/mail-filter\"] =\n    () => m.route(app.route(\"studosi/mail-filter\"));\n\n  extend(AdminNav.prototype, \"items\", items =>\n  {\n    items.add\n    (\n      \"studosi/mail-filter\",\n      AdminLinkButton.component\n      (\n        {\n          href: app.route(\"studosi/mail-filter\"),\n          icon: \"fas fa-envelope-square\",\n          children: app.translator.trans(\"studosi-mail-filter.admin.nav.title\"),\n          description: app.translator.trans(\"studosi-mail-filter.admin.nav.desc\"),\n        }\n      )\n    );\n  });\n}\n","/*\n * Copyright 2020 Studosi\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Alert from 'flarum/components/Alert';\nimport Page from 'flarum/components/Page';\nimport Button from 'flarum/components/Button';\nimport Switch from 'flarum/components/Switch';\n\n\nconst key_to_id =\n  {\n    \"null\": 0,\n    \"whitelist\": 1,\n    \"whitelist_regex\": 2,\n    \"blacklist\": 3,\n    \"blacklist_regex\": 4\n  };\n\nconst id_to_key =\n  {\n    0: \"null\",\n    1: \"whitelist\",\n    2: \"whitelist_regex\",\n    3: \"blacklist\",\n    4: \"blacklist_regex\"\n  };\n\nexport default class SettingsPage extends Page\n{\n  init()\n  {\n    this.storage =\n      {\n        \"whitelist\": [],\n        \"whitelist_regex\": [],\n        \"blacklist\": [],\n        \"blacklist_regex\": []\n      };\n\n    app.store.find(\"mail_rules\").then(this.loadRules.bind(this));\n\n    this.newRules = {};\n    this.isRegex = {};\n\n    for(const key of [\"whitelist\", \"whitelist_regex\", \"blacklist\", \"blacklist_regex\"])\n    {\n      this.newRules[key] =\n        {\n          name: m.prop(\"\"),\n          value: m.prop(\"\")\n        };\n\n      this.isRegex[key] = (key.length > 9);\n    }\n  }\n\n  getExistingBlock(key, full_key)\n  {\n    return this.storage[key].map(rule =>\n    {\n      return m(\"div\", { className: \"Rules-existing\", style: \"float: left;\", display: \"block\"},\n        [\n          Switch.component(\n            {\n              className: \"Rules-switch\",\n              state: rule.active() || false,\n              onchange: this.toggleRuleActivity.bind(this, rule)\n            }),\n          m(\"input\",\n            {\n              className: \"FormControl Rules-name\",\n              value: rule.name(),\n              placeholder: app.translator.trans(\"studosi-mail-filter.admin.settings.rule.name_placeholder\"),\n              oninput: m.withAttr(\"value\", this.updateRuleName.bind(this, rule))\n            }),\n          m(\"input\",\n            {\n              className: \"FormControl Rules-value\",\n              value: rule.value(),\n              placeholder: app.translator.trans(full_key + \".\" + \"placeholder\"),\n              oninput: m.withAttr(\"value\", this.updateRuleValue.bind(this, rule, key))\n            }),\n          Button.component(\n            {\n              type: \"button\",\n              className: \"Button Button--warning Rules-button\",\n              icon: \"fa fa-times\",\n              onclick: this.removeRule.bind(this, rule, key)\n            })\n        ])\n    });\n  }\n\n  getNewBlock(key, full_key)\n  {\n    return m(\"div\", { className: \"Rules-new\", style: \"float: left; margin-bottom: 15px\"},\n      [\n        m(\"input\",\n          {\n            className: \"FormControl Rules-name\",\n            value: this.newRules[key].name(),\n            placeholder: app.translator.trans(\"studosi-mail-filter.admin.settings.rule.name_placeholder\"),\n            oninput: m.withAttr(\"value\", this.newRules[key].name)\n          }),\n        m(\"input\",\n          {\n            className: \"FormControl Rules-value\",\n            value: this.newRules[key].value(),\n            placeholder: app.translator.trans(full_key + \".\" + \"placeholder\"),\n            oninput: m.withAttr(\"value\", this.newRules[key].value)\n          }),\n        Button.component(\n          {\n            type: \"button\",\n            className: \"Button Button--warning Rules-button\",\n            icon: \"fa fa-plus\",\n            onclick: this.addRule.bind(this, key)\n          })\n      ]);\n  }\n\n  getBlock(key)\n  {\n    const full_key = \"studosi-mail-filter.admin.\" + key;\n\n    return [\n      m(\"fieldset\", { className: \"settingsPage-\" + key},\n        [\n          m(\"legend\", {}, app.translator.trans(full_key + \".\" + \"label\")),\n          m(\"div\", { className: \"description\" }, app.translator.trans(full_key + \".\" + \"desc\")),\n          m(\"div\", { className: \"rulesContainer\" },\n            this.getExistingBlock(key, full_key), this.getNewBlock(key, full_key))\n        ])];\n  }\n\n  view()\n  {\n    return [\n      m(\"div\", {className: \"studosiMailFilterSettingsPage\" },\n        [\n          m(\"h1\", { className: \"settingsHeader\" }, \"StudoÅ¡i - Mail Filter\"),\n          m(\"div\", { className: \"filterFields\" },\n            [\n              this.getBlock(\"whitelist\"),\n              this.getBlock(\"whitelist_regex\"),\n              this.getBlock(\"blacklist\"),\n              this.getBlock(\"blacklist_regex\")\n            ]),\n          //m(\"div\", { className: \"settingsFooter\" }, [])\n        ])\n    ];\n  }\n\n  updateRuleName(rule, value)\n  { rule.save({ name: value }); }\n\n  updateRuleValue(rule, key, value)\n  {\n    if (!this.isRegex[key] || this.checkRegex(value))\n    { rule.save({ value: value }); }\n  }\n\n  checkRegex(value)\n  {\n    try\n    { new RegExp(value); }\n    catch (e)\n    {\n      alert(app.translator.trans(\"studosi-mail-filter.admin.error.invalid_regex\"));\n      return false;\n    }\n\n    return true;\n  }\n\n  toggleRuleActivity(rule)\n  { rule.save({ active: !rule.active() }); }\n\n  addRule(key, rule)\n  {\n    if(!this.isRegex[key] || this.checkRegex(this.newRules[key].value()))\n    {\n      app.store\n        .createRecord(\"mail_rules\")\n        .save(\n          {\n            rule_type: key_to_id[key],\n            name: this.newRules[key].name(),\n            value: this.newRules[key].value(),\n            active: true\n          })\n        .then(rule =>\n        {\n          this.newRules[key].name(\"\");\n          this.newRules[key].value(\"\");\n          this.storage[key].push(rule);\n\n          m.redraw();\n        });\n    }\n  }\n\n  removeRule(rule_to_remove, key)\n  {\n    rule_to_remove.delete();\n\n    this.storage[key].some((rule, i) =>\n    {\n      if (rule.data.id === rule_to_remove.data.id)\n      {\n        this.storage[key].splice(i, 1);\n        return true;\n      }\n    });\n  }\n\n  loadRules(rules)\n  {\n    for(const entry of rules)\n    {\n      const key = id_to_key[entry.rule_type()];\n\n      this.storage[key].push(entry);\n      m.redraw();\n    }\n  }\n}\n","/*\n * Copyright 2020 Studosi\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport addSettingsPage from \"./addSettingsPage\";\nimport Rule from \"../common/models/rule\";\n\n\napp.initializers.add('studosi/mail-filter', () =>\n{\n  app.store.models.mail_rules = Rule;\n\n  addSettingsPage();\n});\n","/*\n * Copyright 2020 Studosi\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Model from \"flarum/Model\";\nimport mixin from \"flarum/utils/mixin\";\n\nexport default class Rule extends mixin\n(\n  Model,\n  {\n    rule_type: Model.attribute(\"rule_type\"),\n    name: Model.attribute(\"name\"),\n    value: Model.attribute(\"value\"),\n    active: Model.attribute(\"active\")\n  }\n) {}\n","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['components/AdminLinkButton'];","module.exports = flarum.core.compat['components/AdminNav'];","module.exports = flarum.core.compat['components/Alert'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/Page'];","module.exports = flarum.core.compat['components/Switch'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['utils/mixin'];"],"sourceRoot":""}